async function startSearch() {
    const query = document.getElementById('searchInput').value.trim();
    const maxResults = document.getElementById('maxResults').value;
    const yearStart = document.getElementById('yearStart').value;
    const yearEnd = document.getElementById('yearEnd').value;
    
    if (!query) {
        showStatus('Please enter a search query', 'error');
        return;
    }
    
    // UI Updates
    document.getElementById('searchBtn').disabled = true;
    showStatus('üîç Searching across databases...', 'loading');
    document.getElementById('progressBar').classList.add('show');
    updateProgress(10);
    
    try {
        const response = await fetch('/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'  // CRITICAL: Tell server we want JSON
            },
            body: JSON.stringify({
                query: query,
                max_results: parseInt(maxResults),
                year_start: yearStart || null,
                year_end: yearEnd || null
            })
        });
        
        // ‚úÖ CRITICAL FIX: Check if response is HTML before parsing JSON
        const contentType = response.headers.get('content-type');
        const text = await response.text(); // Get raw text first
        
        // Check if it's HTML (error page)
        if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
            console.error('Server returned HTML error:', text);
            throw new Error('Server error - received HTML instead of JSON. Check server logs.');
        }
        
        // Check content-type header
        if (contentType && contentType.includes('text/html')) {
            throw new Error('Server returned HTML instead of JSON');
        }
        
        // Now safely parse JSON
        let data;
        try {
            data = JSON.parse(text);
        } catch (e) {
            console.error('Invalid JSON:', text);
            throw new Error('Server returned invalid JSON');
        }
        
        // Handle HTTP errors (404, 500, etc)
        if (!response.ok) {
            throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
        }
        
        // Success
        searchId = data.search_id || Date.now().toString();
        updateProgress(30);
        showStatus('‚úÖ Search initiated! Processing...', 'success');
        
        // Start checking status
        checkStatus();
        statusCheckInterval = setInterval(checkStatus, 3000);
        
    } catch (error) {
        console.error('Search error:', error);
        showStatus('‚ùå Error: ' + error.message, 'error');
        document.getElementById('searchBtn').disabled = false;
        document.getElementById('progressBar').classList.remove('show');
    }
}
